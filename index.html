<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bridd Jump</title>
<style>
body { margin:0; overflow:hidden; background:black; font-family:sans-serif; }
canvas { display:block; }
#ui { position:absolute; top:0; left:0; width:100%; height:100%; text-align:center; pointer-events:none; }
#startBtn {
  position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
  font-size:30px; padding:15px 30px; cursor:pointer; border:none; border-radius:10px;
  background:#0ff; color:black; font-weight:bold;
}
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<div id="ui"><button id="startBtn">Start Game</button></div>
<script>
const canvas=document.getElementById("gameCanvas");
const ctx=canvas.getContext("2d");
canvas.width=window.innerWidth; canvas.height=window.innerHeight;

const GRAVITY=0.8, JUMP=-15, BLOCK_SIZE=20;
let platforms=[], spikes=[], gems=[], crashPieces=[], particles=[], lines=[];
let score=0, bestScore=0, cheatsUnlocked=false;
let cameraX=0,cameraY=0,globalTime=0, animationFrameId;
let platformHeightVar=100, strikeChance=0.2, spaceVar=200;

let player={
  x:100,y:100,width:40,height:40,color:"#0ff",vy:0,
  onGround:false,jumpsLeft:2,visible:true,
  horizMultiplier:1, vertMultiplier:1, speed:6
};

let cheats={infiniteJump:false,float:false,invincible:false};

function resetGame(){
  score=0; player.x=100; player.y=100; player.vy=0; player.onGround=false;
  player.jumpsLeft=2; platforms=[]; spikes=[]; gems=[]; lines=[];
  generateInitialPlatforms(); update();
}
function tryDie(){
  if(cheats.invincible) return;
  if(score>bestScore) bestScore=score;
  cancelAnimationFrame(animationFrameId);
  document.getElementById("startBtn").style.display="block";
}
function spawnParticles(x,y,type){
  for(let i=0;i<10;i++){
    particles.push({x,y,vx:(Math.random()-0.5)*5,vy:(Math.random()-0.5)*5,life:30,color:type==="land"?"#0ff":"#fff"});
  }
}
function generateInitialPlatforms(){
  let baseY=canvas.height-100;
  for(let i=0;i<10;i++){generateBlockPlatform(i*200,baseY);}
}
function generateBlockPlatform(x,y){
  platforms.push({x,y,width:120,height:20,color:{r:0,g:255,b:255},passed:false});
}
function addLine(){
  lines.push({x:canvas.width,y:Math.random()*canvas.height}); // always from right edge
}

function update(){
  globalTime+=0.016;
  player.vy+=GRAVITY*player.vertMultiplier;
  if(cheats.float) player.vy=0;
  player.y+=player.vy;
  player.x+=player.speed*player.horizMultiplier;

  // platform collision
  for(let plat of platforms){
    if(player.x+player.width>plat.x && player.x<plat.x+plat.width &&
       player.y+player.height>plat.y && player.y+player.height<plat.y+plat.height+player.vy){
      if(player.vy>=0){
        player.y=plat.y-player.height; player.vy=0; player.onGround=true; player.jumpsLeft=2;
        spawnParticles(player.x+player.width/2, player.y+player.height, "land");
      }
    }
    if(!plat.passed && player.x>plat.x+plat.width){ score+=1; plat.passed=true; }
  }
  if(player.y>canvas.height){ player.jumpsLeft=1; tryDie(); }

  // spikes
  for(let spike of spikes){
    if(!spike.passed && player.x>spike.x+spike.width){ score+=1; spike.passed=true; }
  }

  // gems
  for(let g of gems){
    if(!g.collected && player.x+player.width>g.x && player.x<g.x+g.size && player.y+player.height>g.y && player.y<g.y+g.size){
      score+=50; g.collected=true; spawnParticles(g.x+g.size/2,g.y+g.size/2,"double");
    }
  }

  let lastPlatform=platforms[platforms.length-1];
  if(lastPlatform.x < player.x + canvas.width){ generateBlockPlatform(lastPlatform.x,lastPlatform.y); }
  addLine();

  const targetCamX=player.x-150;
  const targetCamY=player.y - canvas.height/2 + player.height*1.5;
  cameraX = cameraX*0.9 + targetCamX*0.1;
  cameraY = cameraY*0.9 + targetCamY*0.1;

  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle="#fff"; ctx.font="40px sans-serif";
  ctx.fillText(score,20,50);

  for(let plat of platforms){
    ctx.fillStyle="#0ff"; ctx.fillRect(plat.x-cameraX,plat.y-cameraY,plat.width,plat.height);
  }
  for(let g of gems){
    if(!g.collected){ ctx.fillStyle="white"; ctx.fillRect(g.x-cameraX,g.y-cameraY,g.size,g.size);}
  }
  if(player.visible){
    ctx.fillStyle=player.color;
    ctx.fillRect(player.x-cameraX, player.y-cameraY, player.width, player.height);
  }
  for(let l of lines){
    l.x -= player.speed*0.5*player.horizMultiplier; 
    ctx.strokeStyle="rgba(255,255,255,0.3)"; ctx.lineWidth=2;
    ctx.beginPath(); ctx.moveTo(l.x-cameraX, l.y-cameraY); ctx.lineTo(l.x+50-cameraX,l.y-cameraY); ctx.stroke();
  }
  lines = lines.filter(l=>l.x>0);

  animationFrameId=requestAnimationFrame(update);
}

document.getElementById("startBtn").addEventListener("click", ()=>{document.getElementById("startBtn").style.display="none"; resetGame();});
function showStartScreen(){document.getElementById("startBtn").style.display="block";}

window.addEventListener("keydown", e=>{
  if(e.ctrlKey && e.shiftKey && e.code==="KeyA"){
    const input=prompt("Enter command:"); if(!input) return;
    const args=input.trim().split(/\s+/);
    const command=args[0], root1=args[1], root2=args[2], root3=args[3], root4=args[4];

    if(command==="/gamerule"){
      switch(root1){
        case "infiniteJump": cheats.infiniteJump=(root2==="true"); break;
        case "death": cheats.invincible=(root2==="false"); break;
        case "speed":
          if(!player.speedMultiplier) player.speedMultiplier=1;
          if(root2==="reset") player.speedMultiplier=1;
          if(root2==="add" && !isNaN(parseFloat(root3))) player.speedMultiplier+=parseFloat(root3);
          if(root2==="set" && !isNaN(parseFloat(root3))) player.speedMultiplier=parseFloat(root3);
          player.horizMultiplier=player.vertMultiplier=player.speedMultiplier; break;
      }
    }
    if(command==="/code"){
      if(root1==="770709"){ alert("Test mode activated"); cheatsUnlocked=true; }
    }
    if(command==="/score"){
      if(root1==="add"){ score+=parseInt(root2); }
      if(root1==="reset"){ score=0; }
      if(root1==="set"){ score=parseInt(root2); }
    }
    if(command==="/variable"){
      if(root1==="directChange"){
        if(root4==="valid"){
          if(root2 in player){
            let num=parseFloat(root3); player[root2]=isNaN(num)?root3:num;
          } else if(root2==="platformHeightVar"){ platformHeightVar=parseFloat(root3)||platformHeightVar; }
          else if(root2==="strikeChance"){ strikeChance=Math.max(0,Math.min(100,parseFloat(root3)||0))/100; }
          else if(root2==="spaceVar"){ spaceVar=parseFloat(root3)||spaceVar; }
        }
      }
      else if(root1==="jumpHeight"){ player.vertMultiplier=parseFloat(root3)||player.vertMultiplier; }
      else if(root1==="generation"){
        if(root2==="heightVarP"){ platformHeightVar=parseFloat(root3)||platformHeightVar; }
        if(root2==="strike"){ strikeChance=Math.max(0,Math.min(100,parseFloat(root3)||0))/100; }
        if(root2==="spaceVarP"){ spaceVar=parseFloat(root3)||spaceVar; }
      }
      else if(!root1){ // plain /variable
        let info="";
        info+="Test mode: "+(cheatsUnlocked?"true":"false")+"\\n";
        info+="Infinite jump: "+(cheats.infiniteJump?"true":"false")+"\\n";
        info+="Float: "+(cheats.float?"true":"false")+"\\n";
        info+="Death enabled: "+(!cheats.invincible?"true":"false")+"\\n";
        info+="Score: "+score+"\\n";
        info+="Best score: "+bestScore+"\\n";
        let acc="player";
        const creators=["bw55133@pausd.us","ikunbeautiful@gmail.com","benranwu@gmail.com"];
        acc = creators.includes("bw55133@pausd.us") ? "creator" : "player"; // placeholder logic
        info+="Account: "+acc+"\\n";
        info+="Player Speed: "+player.speed+"\\n";
        info+="Jump Height: "+player.vertMultiplier+"\\n";
        alert(info);
      }
    }
  }
});
</script>
</body>
</html>
