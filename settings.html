<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Schedule | Infinite Campus</title>
<style>
  body { margin:0; background:#111; color:#0ff; font-family:Arial, sans-serif; overflow:hidden; }
  canvas { display:block; margin:0 auto; background:#222; }
  #startBtn { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
              padding:20px 40px; border:2px solid #0ff; background:black; color:#0ff;
              cursor:pointer; border-radius:10px; }
  #console { position:absolute; bottom:10px; left:50%; transform:translateX(-50%);
             width:400px; padding:5px; background:#000; border:2px solid #0ff; color:#0ff; }
  #uiBox { position:absolute; top:10px; right:10px; padding:10px;
           background:rgba(0,0,0,0.7); border:2px solid #0ff; border-radius:10px; }
</style>
</head>
<body>
<button id="startBtn">Start</button>
<canvas id="gameCanvas" width="800" height="600"></canvas>
<input id="console" placeholder="Enter command (e.g. /score add 10)" />
<div id="uiBox">
  <div id="scoreDisplay">Score: 0</div>
  <div id="bestDisplay">Best: 0</div>
  <div id="lastDisplay">Last Point: 0</div>
</div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
let running = false;
let lastFrameTime = 0;

// ===== SETTINGS =====
let fps = localStorage.getItem("fps") || "60";
fps = (fps === "Unlimited") ? 0 : parseInt(fps);

let quality = localStorage.getItem("quality") || "Extreme+";
let adv = JSON.parse(localStorage.getItem("advancedSettings") || "{}");
adv = Object.assign({jump:0,walk:0,die:0,line:0,glow:0,trail:0,blockTexture:true}, adv);

// ===== GAME STATE =====
let score = 0;
let bestScore = parseInt(localStorage.getItem("bestScore") || "0");
let lastScore = parseInt(localStorage.getItem("lastScore") || "0");
let player = { x: 100, y: 300, vy:0, trail:[] };
let platforms = [];
let dieParticles = [];
let scanOffset = 0;

// UI updates
function updateUI(){
  document.getElementById("scoreDisplay").textContent = "Score: " + score;
  document.getElementById("bestDisplay").textContent = "Best: " + bestScore;
  document.getElementById("lastDisplay").textContent = "Last Point: " + lastScore;
}
updateUI();

// ===== PLATFORM GENERATOR =====
function spawnPlatform(){
  let x = canvas.width;
  let y = 400 + (Math.random()*100 - 50);
  platforms.push({x, y, w:120, h:20});
}
setInterval(()=>{ if(running) spawnPlatform(); },2000);

// ===== PARTICLE HELPERS =====
function makeParticles(x,y,count,color,size){
  for(let i=0;i<count;i++){
    dieParticles.push({
      x, y,
      vx:(Math.random()*2-1)*2,
      vy:(Math.random()*2-1)*2,
      life:50,
      color, size
    });
  }
}

// ===== GAME LOOP =====
function loop(timestamp){
  if(!running) return;

  // FPS limiter
  if(fps>0){
    const interval = 1000/fps;
    if(timestamp - lastFrameTime < interval){
      requestAnimationFrame(loop);
      return;
    }
    lastFrameTime = timestamp;
  }

  // Clear
  ctx.fillStyle = "#111";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // Horizontal Line Effect
  if(adv.line>0){
    scanOffset += adv.line/50;
    ctx.fillStyle = "rgba(0,255,255,0.1)";
    for(let i=0;i<canvas.height;i+=20){
      ctx.fillRect(0, (i+scanOffset)%canvas.height, canvas.width, 2);
    }
  }

  // Draw platforms
  ctx.fillStyle = "#0ff";
  platforms.forEach(p=>{
    ctx.fillRect(p.x, p.y, p.w, p.h);
    if(adv.blockTexture){
      ctx.strokeStyle = "rgba(0,0,0,0.5)";
      for(let i=0;i<p.w;i+=10){
        ctx.beginPath();
        ctx.moveTo(p.x+i, p.y);
        ctx.lineTo(p.x+i, p.y+p.h);
        ctx.stroke();
      }
    }
    p.x -= 2;
  });

  // Trail Effect
  if(adv.trail>0){
    player.trail.push({x:player.x,y:player.y,life:30});
    if(player.trail.length>50) player.trail.shift();
    ctx.fillStyle="rgba(0,255,255,0.3)";
    player.trail.forEach(t=>{
      ctx.globalAlpha=t.life/30 * (adv.trail/100);
      ctx.beginPath();
      ctx.arc(t.x,t.y,5,0,Math.PI*2);
      ctx.fill();
      t.life--;
    });
    ctx.globalAlpha=1;
  }

  // Glow Effect
  if(adv.glow>0){
    let grd = ctx.createRadialGradient(player.x,player.y,10,player.x,player.y,50);
    grd.addColorStop(0,"rgba(0,255,255,"+(adv.glow/200)+")");
    grd.addColorStop(1,"transparent");
    ctx.fillStyle=grd;
    ctx.fillRect(player.x-50,player.y-50,100,100);
  }

  // Player
  ctx.fillStyle="#0ff";
  ctx.fillRect(player.x-10, player.y-10, 20, 20);

  // Walk Effects
  if(adv.walk>0 && timestamp%10<5){
    ctx.fillStyle="rgba(0,255,255,0.5)";
    ctx.fillRect(player.x-15, player.y+10,5,5);
  }

  // Jump Effects
  if(adv.jump>0 && player.vy<-0.5){
    ctx.fillStyle="rgba(0,255,255,0.5)";
    ctx.beginPath();
    ctx.arc(player.x,player.y+15,5+adv.jump/20,0,Math.PI*2);
    ctx.fill();
  }

  // Die Particles
  dieParticles.forEach(p=>{
    ctx.fillStyle=p.color;
    ctx.globalAlpha=p.life/50;
    ctx.fillRect(p.x,p.y,p.size,p.size);
    p.x+=p.vx; p.y+=p.vy; p.life--;
  });
  dieParticles=dieParticles.filter(p=>p.life>0);
  ctx.globalAlpha=1;

  // Score
  score++;
  if(score > bestScore){
    bestScore = score;
    localStorage.setItem("bestScore", bestScore);
  }
  updateUI();

  requestAnimationFrame(loop);
}

// ===== COMMAND HANDLER =====
document.getElementById("console").addEventListener("keydown", e=>{
  if(e.key==="Enter"){
    const cmd = e.target.value.trim();
    e.target.value = "";
    if(cmd.startsWith("/score")){
      const parts = cmd.split(" ");
      if(parts[1]==="set" && !isNaN(parts[2])) score = parseInt(parts[2]);
      if(parts[1]==="add" && !isNaN(parts[2])) score += parseInt(parts[2]);
    }
    if(cmd==="/clear bestScore"){
      bestScore = 0;
      localStorage.setItem("bestScore", 0);
    }
    if(cmd==="/die"){
      running = false;
      if(adv.die>0){
        makeParticles(player.x,player.y,adv.die/2,"#0ff",5);
      }
      lastScore = score;
      localStorage.setItem("lastScore", lastScore);
      alert("You died! Final score: "+score);
      if(score > bestScore){
        bestScore = score;
        localStorage.setItem("bestScore", bestScore);
      }
      updateUI();
      document.getElementById("startBtn").style.display="block";
    }
  }
});

// ===== START =====
document.getElementById("startBtn").addEventListener("click", ()=>{
  running = true;
  score = 0;
  player.trail = [];
  spawnPlatform();
  document.getElementById("startBtn").style.display="none";
  requestAnimationFrame(loop);
});
</script>
</body>
</html>
